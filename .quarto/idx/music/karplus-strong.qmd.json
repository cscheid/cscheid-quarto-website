{"title":"Karplus-Strong Plucked-String Synthesis","markdown":{"yaml":{"title":"Karplus-Strong Plucked-String Synthesis","format":"html","bibliography":["music.bib"],"code-tools":false,"echo":false,"code-fold":false,"css":["karplus-strong.css"]},"containsRefs":false,"markdown":"\n\n::: {.column-page}\n\n<div id=\"piano\"></div>\n\n:::\n\n```{ojs}\n//| output: false\nimport { init } from \"/src/audio/karplus-strong.js\"\nimport { init as initPiano } from \"/src/audio/piano.js\"\n\nojsPiano = {\n  if (window._initEverything)\n    return;\n  window.d3 = d3;\n  window._initEverything = true;\n  initPiano();\n  d3.select(\"#piano\")\n    .select(\"svg\")\n    .attr(\"viewBox\", `0 0 960 400`)\n    .attr(\"width\", \"100%\")\n    .attr(\"height\", null);\n  await new Promise((res) => {\n    init(res);\n  });\n}\n\nspectrogramArray = {\n  ojsPiano;\n  return Generators.observe(next => {\n    const newData = (array) => {\n      next(array);\n    }\n    window.player.spectrogram(newData, { fftSize: 32768 });\n  });\n}\n\nfunction findPeaks(array)\n{\n  const result = [];\n  for (let i = 1; i < array.length -1; ++i) {\n    if (array[i] > array[i-1] && array[i] > array[i+1]) {\n      result.push({i, v: array[i]});\n    }\n  }\n  return result;\n}\n\npeaks = findPeaks(spectrogramArray)\n  .filter(v => v.v > -60)\n  .map(v => ({ freq: v.i * (48000 / 32768), amplitude: v.v }));\n```\n\n:::{.column-page}\n\n```{ojs}\n{\n  let result = Plot.plot({\n    marks: [\n      Plot.line(\n        peaks.map(v => [{ freq: v.freq, amplitude: -60 }, v, {freq: NaN, amplitude: NaN}]).flat(), \n        {\n          x: \"freq\",\n          y: \"amplitude\",\n          clip: true\n        }\n      )\n    ],\n    y: { domain: [-60, -30], label: \"amplitude (dB)\" },\n    x: { domain: [10, 10000], label: \"frequency (Hz)\" },\n    height: 200,\n    width: 800,\n  });\n  result.setAttribute(\"width\", \"100%\");\n  return result;\n}\n```\n\n:::\n\nStrings in stringed instruments make _harmonic_ sounds: each string produces not only a base frequency but a mix of sounds of different frequencies. A \"harmonic\" sound means simply that the frequencies of such a sound are always integer multiples of the base frequency. Typical western music features predominantly harmonic sounds, and such harmonic sounds account for much of western music's notion of [consonance and dissonance](consonance-and-dissonance.qmd). So if we want to synthesize musical instruments that can be used to create western-sounding music, we better be able to create sounds with lots of harmonic tones.\n\nA plucking or hammering sound starts percussive and non-harmonic, but quickly resolves into a base frequency and lots of harmonic overtones. The higher the frequency, the faster these harmonics decay, and on long sustains we're left with only the low harmonics. Modeling this on slow computers used to be a significant challenge, until in 1983 Karplus and Strong devised a very simple method that sounds great to this day [@karplus1983digital].\n\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":false,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["karplus-strong.css"],"output-file":"karplus-strong.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"99.9.9","theme":["sandstone","../cscheid-net.scss"],"title":"Karplus-Strong Plucked-String Synthesis","bibliography":["music.bib"]},"extensions":{"book":{"multiFile":true}}}}}